<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Checkout</title>
  <style>
    body { font-family: Arial; background: #f9f9f9; margin: 0; }
    header { background: #333; color: white; padding: 1rem; text-align: center; }
    nav { background-color: #555; display: flex; justify-content: center; padding: 0.5rem; }
    nav a { color: white; margin: 0 1rem; text-decoration: none; }
    nav a:hover { text-decoration: underline; }
    .container { max-width: 600px; margin: 2rem auto; background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    label { display: block; margin-top: 1rem; }
    input { width: 100%; padding: 0.5rem; margin-top: 0.3rem; }
    button { margin-top: 1.5rem; padding: 0.7rem 1.5rem; font-size: 1rem; }
    .primary { background: green; color: white; border: none; border-radius: 5px; }
    .secondary { background: red; color: white; border: none; border-radius: 5px; margin-left: 1rem; }
  </style>
  <script type="text/javascript" charset="utf-8">
    (function (g, e, n, es, ys) {
      g['_genesysJs'] = e;
      g[e] = g[e] || function () {
        (g[e].q = g[e].q || []).push(arguments)
      };
      g[e].t = 1 * new Date();
      g[e].c = es;
      ys = document.createElement('script'); ys.async = 1; ys.src = n; ys.charset = 'utf-8'; document.head.appendChild(ys);
    })(window, 'Genesys', 'https://apps.usw2.pure.cloud/genesys-bootstrap/genesys.min.js', {
      environment: 'prod-usw2',
      deploymentId: 'f813f27a-0633-4d16-9834-9e4f9caec502'
    });
  </script>
  <script type="text/javascript">
    Genesys("command", "Journey.pageview", {
      pageTitle: document.title,
      pageLocation: window.location.href,
      customAttributes: { 
        visitTimestamp: new Date().toISOString() // Renamed and still string
      },
      traitsMapper: []
    });
  </script>
</head>
<body>

  <header>
    <h1>Checkout</h1>
  </header>

  <nav>
    <a href="index.html">Home</a>
    <a href="cart.html">Cart</a>
  </nav>

  <div class="container">
    <form id="checkoutForm">
      <label>Shipping Address: <input type="text" required></label>
      <label>Payment Method:
        <select required>
          <option value="" disabled selected>Select a payment method</option>
          <option value="credit_card">Credit Card</option>
          <option value="debit_card">Debit Card</option>
          <option value="UPI">UPI</option>
          <option value="COD">Cash on Delivery</option>
        </select>
      </label>
      <label>Voucher Code: <input type="text" placeholder="Optional"></label>
      <button type="submit" class="primary">Place Order</button>
      <button type="button" class="secondary" onclick="location.href='cart.html'">Cancel</button>
    </form>
    <div id="confirmation" style="display:none; text-align:center; margin-top: 2rem;">
      <h2>Order Placed Successfully!</h2>
      <p>Thank you for your purchase.</p>
      <a href="index.html">Back to Home</a>
    </div>
  </div>

  <script>
    const products = [
      { id: 1, name: "Wireless Headphones", price: 1999 },
      { id: 2, name: "Running Shoes", price: 4499 },
      { id: 3, name: "Smart Watch", price: 2999 },
      { id: 4, name: "Leather Wallet", price: 799 },
      { id: 5, name: "Sunglasses", price: 1499 },
      { id: 6, name: "Backpack", price: 2499 }
    ];
  
    document.getElementById("checkoutForm").addEventListener("submit", function (e) {
      e.preventDefault();
      console.log("Place Order button clicked");
  
      // Retrieve cart data
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      if (cart.length === 0) {
        alert("Your cart is empty!");
        return;
      }
  
      const productsInCart = cart.map(id => products.find(p => p.id === id));
      const totalAmount = productsInCart.reduce((sum, product) => sum + product.price, 0);
  
      // Clear the cart
      localStorage.removeItem("cart");
  
      // Hide the form and show the confirmation message
      this.style.display = "none";
      document.getElementById("confirmation").style.display = "block";
  
      // Track the successful order using Genesys Journey.record
      Genesys("command", "Journey.record", {
        eventName: "order_placed",
        customAttributes: {
          orderTotal: totalAmount,
          productCount: productsInCart.length,
          products: productsInCart.map(product => ({
            id: product.id,
            name: product.name,
            price: product.price,
            orderplaced: true
          }))
        },
        traitsMapper: []
      });
    });
  </script>
</body>
</html>